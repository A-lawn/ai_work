# Gateway Service 专属配置

server:
  port: 8080

spring:
  application:
    name: gateway-service
  
  cloud:
    gateway:
      discovery:
        locator:
          enabled: true
          lower-case-service-id: true
      
      routes:
        # 文档管理服务路由
        - id: document-service
          uri: lb://document-service
          predicates:
            - Path=/api/v1/documents/**
          filters:
            - StripPrefix=0
            - name: RequestRateLimiter
              args:
                redis-rate-limiter.replenishRate: 100
                redis-rate-limiter.burstCapacity: 200
        
        # 会话管理服务路由
        - id: session-service
          uri: lb://session-service
          predicates:
            - Path=/api/v1/sessions/**
          filters:
            - StripPrefix=0
        
        # 查询服务路由
        - id: query-service
          uri: lb://session-service
          predicates:
            - Path=/api/v1/query/**
          filters:
            - StripPrefix=0
        
        # 认证服务路由
        - id: auth-service
          uri: lb://auth-service
          predicates:
            - Path=/api/v1/auth/**
          filters:
            - StripPrefix=0
        
        # 配置管理服务路由
        - id: config-service
          uri: lb://config-service
          predicates:
            - Path=/api/v1/config/**
          filters:
            - StripPrefix=0
        
        # 监控日志服务路由
        - id: monitor-service
          uri: lb://monitor-service
          predicates:
            - Path=/api/v1/logs/**,/api/v1/metrics/**,/api/v1/stats/**
          filters:
            - StripPrefix=0
      
      # 全局过滤器配置
      default-filters:
        - AddResponseHeader=X-Response-Time, ${responseTime}
      
      # 全局 CORS 配置
      globalcors:
        cors-configurations:
          '[/**]':
            allowedOrigins: "*"
            allowedMethods:
              - GET
              - POST
              - PUT
              - DELETE
              - OPTIONS
            allowedHeaders: "*"
            allowCredentials: false
            maxAge: 3600

# Sentinel 配置
spring.cloud.sentinel:
  transport:
    dashboard: sentinel-dashboard:8858
  datasource:
    flow:
      nacos:
        server-addr: ${spring.cloud.nacos.discovery.server-addr}
        namespace: ${spring.cloud.nacos.discovery.namespace}
        dataId: gateway-service-flow-rules
        groupId: SENTINEL_GROUP
        rule-type: flow
    degrade:
      nacos:
        server-addr: ${spring.cloud.nacos.discovery.server-addr}
        namespace: ${spring.cloud.nacos.discovery.namespace}
        dataId: gateway-service-degrade-rules
        groupId: SENTINEL_GROUP
        rule-type: degrade
    system:
      nacos:
        server-addr: ${spring.cloud.nacos.discovery.server-addr}
        namespace: ${spring.cloud.nacos.discovery.namespace}
        dataId: gateway-service-system-rules
        groupId: SENTINEL_GROUP
        rule-type: system
